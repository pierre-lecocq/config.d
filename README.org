#+TITLE: Debian install and config deployment
#+AUTHOR: Pierre Lecocq
#+EMAIL: pierre.lecocq@gmail.com
#+STARTUP: content

** Prepare

*** Grub timeout

#+begin_src sh
sudo sed -i s/GRUB_TIMEOUT=5/GRUB_TIMEOUT=1/ /etc/default/grub
sudo update-grub
#+end_src

*** Apt

#+begin_src sh
if ! [ -f /etc/apt/sources.list.ori ]; then
    sudo cp /etc/apt/sources.list /etc/apt/sources.list.ori
fi

sudo sed -e 's/ main$/ main contrib non-free/g' -i /etc/apt/sources.list
sudo echo "APT::Install-Recommends \"0\";" > /etc/apt/apt.conf.d/50norecommends

sudo apt-get update
#+end_src

** Install

*** Base

Install the base system packages

#+begin_src sh
sudo apt-get autoremove --purge -y exim4-.\* portmap rpcbind cups
sudo apt-get install -y aspell \
                        aspell-en \
                        aspell-fr \
                        autoconf \
                        automake \
                        build-essential \
                        clamav \
                        clisp \
                        cmake \
                        curl \
                        emacs \
                        fail2ban \
                        gcc \
                        gdb \
                        gettext \
                        git \
                        gnutls-bin \
                        irb \
                        libncurses5-dev \
                        libruby \
                        linux-headers-$(uname -r|sed 's,[^-]*-[^-]*-,,') \
                        mailutils \
                        manpages-dev \
                        mutt-patched \
                        nmap \
                        offlineimap \
                        p7zip \
                        python \
                        rsync \
                        ruby \
                        ruby-dev \
                        rubygems \
                        sbcl \
                        strace \
                        tcpdump \
                        tree \
                        unrar \
                        unzip \
                        usbmount \
                        valgrind \
                        wget \
                        yasm \
                        zip
#+end_src

*** Window manager

Install i3wm and some GUI apps

#+begin_src sh
sudo apt-get install -y alsa-oss \
                        alsa-tools \
                        alsa-utils \
                        alsamixergui \
                        arandr \
                        chromium \
                        compton \
                        dunst \
                        feh \
                        firmware-iwlwifi \
                        flashplugin-nonfree \
                        fonts-inconsolata \
                        i3 \
                        i3lock \
                        i3status \
                        libnotify-bin \
                        mirage \
                        notification-daemon \
                        numlockx \
                        orage \
                        rxvt-unicode-256color \
                        scrot \
                        suckless-tools \
                        tango-icon-theme \
                        thunar \
                        transmission-gtk \
                        ttf-bitstream-vera \
                        ttf-dejavu \
                        ttf-inconsolata \
                        vlc \
                        xclip \
                        xorg \
                        xpdf

Xorg -configure

echo "exec i3" > ~/.xinitrc
#+end_src

*** Pentest

Install some pentest tools

#+begin_src sh
sudo apt-get install -y dsniff \
                        ettercap \
                        john \
                        kismet \
                        libdl-ruby \
                        libiconv-ruby \
                        libopenssl-ruby \
                        libreadline-ruby \
                        libsqlite3-dev \
                        libsqlite3-ruby \
                        libyaml-ruby \
                        libzlib-ruby \
                        netcat \
                        ngrep \
                        nikto \
                        python-beautifulsoup \
                        python-geoip
                        python-libxml2 \
                        python-pycurl \
                        ratproxy \
                        siege \
                        sqlite3 \
                        sqlmap \
                        subversion \
                        tcpdump \
                        tcptrace \
                        w3af

sudo mkdir -p /usr/local/bin

svn co http://www.metasploit.com/svn/framework3/trunk /usr/local/metasploit;
sudo ln -s /usr/local/metasploit/msfconsole /usr/local/bin/msfconsole

svn co https://xsser.svn.sourceforge.net/svnroot/xsser /usr/local/xsser
sudo ln -s /usr/local/xsser/xsser /usr/local/bin/xsser
#+end_src

*** Virtualizers

Install some virtualizers (virtualbox and kvm)

#+begin_src sh
sudo apt-get install -y linux-headers-amd64 \
                        virtualbox-ose \
                        virtualbox-ose-dkms

sudo modprobe vboxdrv

sudo apt-get install -y bridge-utils \
                        libvirt-bin \
                        qemu-kvm \
                        virt-manager \
                        virtinst
#+end_src

*** Emacs

Compile Emacs from source and install it

#+begin_src sh
sudo apt-get install -y aspell \
                        aspell-en \
                        aspell-fr \
                        autoconf \
                        build-essential \
                        cvs \
                        fetchmail \
                        fonts-inconsolata \
                        gcc \
                        gdb \
                        git \
                        libcanberra-gtk3-dev \
                        libdbus-1-dev \
                        libgif-dev \
                        libgnutls-dev \
                        libgtk-3-dev \
                        libjpeg-dev \
                        libncurses5-dev \
                        libtiff5-dev \
                        libxml2-dev \
                        libxpm-dev \
                        libxslt-dev \
                        linux-headers-$(uname -r|sed 's,[^-]*-[^-]*-,,') \
                        mailutils \
                        texi2html \
                        texify \
                        texinfo \
                        texlive \
                        texlive-base \
                        texlive-generic-recommended \
                        texlive-latex-base \
                        texlive-latex-extra \
                        w3m \
                        yasm

git clone git://git.savannah.gnu.org/emacs.git ~/emacs.src

cd ~/emacs.src && ./autogen.sh && ./configure && make && sudo make install
#+end_src

** Deploy config

*** Prepare directories

Prepare filesystem

#+begin_src sh
mkdir -p ~/.mail/mailboxes
mkdir -p ~/work/src
mkdir -p ~/.config
#+end_src

*** Clone repositories

Clone wanted repositories

#+begin_src sh
git clone https://github.com/pierre-lecocq/emacs.d ~/work/src/emacs.d
git clone https://github.com/pierre-lecocq/mail.d ~/work/src/mail.d
git clone https://github.com/pierre-lecocq/org-files ~/org-files
#+end_src

*** Create links

Link config files

#+begin_src sh
ln -s ~/work/src/config.d/dotfiles/Xdefaults ~/.Xdefaults
ln -s ~/work/src/config.d/dotfiles/screenrc ~/.screenrc
ln -s ~/work/src/config.d/dotfiles/gitconfig ~/.gitconfig
ln -s ~/work/src/config.d/dotfiles/gemrc ~/.gemrc
ln -s ~/work/src/config.d/dotfiles/bashrc ~/.bashrc
ln -s ~/work/src/config.d/dotfiles/bashrc_profile ~/.bashrc_profile
ln -s ~/work/src/config.d/dotfiles/gtkrc-2.0 ~/.gtkrc-2.0
ln -s ~/work/src/config.d/dotfiles/gtk-3.0 ~/.gtk-3.0

ln -s ~/work/src/config.d/dotfiles/tint2 ~/.config/tint2
ln -s ~/work/src/config.d/dotfiles/i3 ~/.config/i3
ln -s ~/work/src/config.d/dotfiles/i3status ~/.config/i3status
ln -s ~/work/src/config.d/dotfiles/dunst ~/.config/dunst
ln -s ~/work/src/config.d/dotfiles/user-dirs.dirs ~/.config/user-dirs.dirs

ln -s ~/work/src/config.d/bin ~/work/bin
chmod 700 ~/work/bin/*

ln -s ~/work/src/config.d/images ~/images
#+end_src

** Setup

*** Wifi

Prepare

#+begin_src sh
sudo apt-get install firmware-iwlwifi wpasupplicant
sudo chmod 0600 /etc/network/interfaces
#+end_src

List wifi networks

#+begin_src sh
sudo iwlist scan
#+end_src

In =/etc/network/interfaces=, add:

#+begin_src sh
auto wlan0
iface wlan0 inet dhcp
        wireless-mode ad-hoc
        wireless-essid MyESSID
        wireless-key MyPASSWD
        wpa-ssid MyESSID
    	wpa-psk MyPASSWD
#+end_src

Ifup the interface

#+begin_src sh
sudo ifup wlan0
#+end_src
